<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√†nh Tr√¨nh B√¨nh An - STOP 4P</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <canvas id="fireworks-canvas"></canvas>

    <button id="back-btn" onclick="goBack()">üîô Quay l·∫°i</button>

    <div id="stage-0" class="stage active" style="display: flex;">
        <div id="welcome-modal" class="welcome-container">
            <h1>Ch√†o m·ª´ng</h1>
            <p class="welcome-sub">H√†nh tr√¨nh t√¨m l·∫°i b√¨nh an</p>
            <div id="step-phone">
                <input type="number" id="input-phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i c·ªßa ch·ªã...">
                <button class="btn-start" onclick="checkPhone()">Ti·∫øp t·ª•c</button>
            </div>
            <div id="step-name" style="display:none;">
                <input type="text" id="input-name" placeholder="T√™n c·ªßa ch·ªã l√†...">
                <button class="btn-start" onclick="registerAndStart()">B·∫Øt ƒë·∫ßu</button>
            </div>
            <div id="step-welcome-back" style="display:none;">
                <div id="welcome-message"></div>
                <button class="btn-start" onclick="startGameDirectly()">Ti·∫øp t·ª•c h√†nh tr√¨nh</button>
                <button class="btn-history" onclick="showMyHistory()">Xem nh·∫≠t k√Ω c·ªßa t√¥i</button>
            </div>
        </div>
    </div>

    <div id="stage-emotion-check" class="stage">
        <h2 style="color: #00695c;">Ch·ªã ƒëang c·∫£m th·∫•y th·∫ø n√†o?</h2>
        <div id="current-emoji" style="font-size: 80px; margin: 20px 0;">üòê</div>
        <div id="current-status" style="font-size: 24px; font-weight: bold; color: #f57f17; margin-bottom: 30px;">5 - B√¨nh th∆∞·ªùng (·ªîn)</div>
        <div style="width: 80%; max-width: 400px;">
            <input type="range" id="emotion-range" min="1" max="10" value="5" oninput="updateEmotionDisplay()" style="width: 100%;">
        </div>
        <button class="btn-start" style="margin-top: 40px;" onclick="submitInitialEmotion()">X√°c nh·∫≠n</button>
    </div>

    <div id="stage-1" class="stage">
        <div id="greeting-text"></div>
        <div id="monkey-metaphor">T√¢m tr√≠ x√°o tr·ªôn nh∆∞ b·∫ßy kh·ªâ...</div>
        <div id="scene-s1" class="garden-scene"></div>
        <div id="top-message-area"></div>
        <div id="countdown-display"></div>
        <div id="controls-container">
            <button id="stop-btn" onmousedown="startProcess(event)" onmouseup="cancelProcess()" onmouseleave="cancelProcess()" ontouchstart="startProcess(event)" ontouchend="cancelProcess()">üõë</button>
            <div id="guide-text-s1">Nh·∫•n gi·ªØ chu√¥ng ƒë·ªÉ ra l·ªánh<br>"D·ª™NG L·∫†I"</div>
        </div>
        <div id="success-panel">
            <button class="next-btn" onclick="switchStage(2)">Ti·∫øp t·ª•c</button>
        </div>
    </div>

    <div id="stage-2" class="stage">
        <div id="instruction-dragon">H√≠t v√†o...</div>
        <div class="game-scene">
            <div class="dragon-container">
                <div class="head">
                    <div class="eye"></div><div class="cheek"></div>
                    <div id="mouth" class="mouth smile"></div>
                    <div id="fire" class="fire-stream"></div>
                </div>
                <div class="body"><div id="belly" class="belly"></div></div>
                <div class="arm left"></div><div class="arm right"></div>
            </div>
            <div class="pinwheel-wrapper">
                <div class="stick"></div>
                <div id="pinwheel" class="pinwheel-container">
                    <div class="blade b1"></div><div class="blade b2"></div>
                    <div class="blade b3"></div><div class="blade b4"></div>
                    <div class="center-dot"></div>
                </div>
            </div>
        </div>
        <button id="interaction-area" style="margin-top: 30px;">Nh·∫•n gi·ªØ ƒë·ªÉ H√≠t v√†o</button>
        <button id="next-btn-dragon" onclick="switchStage(3)" style="display:none;">Ti·∫øp t·ª•c</button>
    </div>

    <div id="stage-3" class="stage">
        <div id="guide-text-body"></div>
        <div id="meditation-container"></div>
        <div id="action-buttons-body">
            <button id="continue-btn-body" onclick="switchStage(4)">Ti·∫øp t·ª•c</button>
        </div>
    </div>

    <div id="stage-4" class="stage">
        <div id="selection-screen">
            <h2>C·∫£m x√∫c c·ªßa ch·ªã l√∫c n√†y?</h2>
            <p class="subtitle">H√£y ch·ªçn m·ªôt b√© Capybara nh√©</p>
            <div class="emotion-grid">
                <div class="capy-card" onclick="selectEmotion('Vui v·∫ª')"><p>Vui v·∫ª</p></div>
                <div class="capy-card" onclick="selectEmotion('B√¨nh an')"><p>B√¨nh an</p></div>
                <div class="capy-card" onclick="selectEmotion('Bu·ªìn b√£')"><p>Bu·ªìn b√£</p></div>
                <div class="capy-card" onclick="selectEmotion('Lo √¢u')"><p>Lo √¢u</p></div>
                <div class="capy-card" onclick="selectEmotion('T·ª©c gi·∫≠n')"><p>T·ª©c gi·∫≠n</p></div>
                <div class="capy-card" onclick="selectEmotion('Tr·ªëng r·ªóng')"><p>Tr·ªëng r·ªóng</p></div>
            </div>
        </div>
        <div id="feedback-screen">
            <div class="feedback-text">C·∫£m ∆°n ch·ªã ƒë√£ nh·∫≠n di·ªán c·∫£m x√∫c c·ªßa m√¨nh.</div>
            <button class="btn-next-capy" onclick="switchStage(5)">Ti·∫øp t·ª•c</button>
        </div>
    </div>

    <div id="stage-5" class="stage">
        <div class="sun"></div>
        <div id="hint-text-cloud"></div>
        <div id="input-container-cloud">
            <h2>O - Quan S√°t Suy Nghƒ©</h2>
            <p>Suy nghƒ© n√†o ƒëang l√†m phi·ªÅn ch·ªã? H√£y vi·∫øt ra v√† ƒë·ªÉ gi√≥ cu·ªën ƒëi.</p>
            <input type="text" id="thoughtInput" placeholder="V√≠ d·ª•: C·∫£m th·∫•y m·ªát m·ªèi..." autocomplete="off">
            <button class="btn-primary" onclick="createCloud()">H√≥a th√†nh M√¢y</button>
            <button class="btn-secondary" onclick="switchStage(6)">ƒêi ti·∫øp</button>
        </div>
    </div>

    <div id="stage-6" class="stage">
        <div id="intro-screen-jar">
            <div class="instruction-text">H√£y vi·∫øt m·ªôt l·ªùi nh·∫Øn nh·ªß...</div>
            <button class="btn-start" onclick="goToWrite()">B·∫Øt ƒë·∫ßu vi·∫øt</button>
        </div>
        <div id="write-screen-jar">
            <div class="heart-note">
                <textarea id="note-input" placeholder="G·ª≠i g·∫Øm y√™u th∆∞∆°ng..."></textarea>
            </div>
            <button class="btn" onclick="saveToJar()">C·∫•t v√†o h≈©</button>
        </div>
        <div id="jar-screen-final">
            <div class="jar" id="jar"></div>
            <div id="final-message">Y√™u th∆∞∆°ng ƒë√£ ƒë∆∞·ª£c c·∫•t gi·ªØ!</div>
            <button id="continue-btn-jar" onclick="switchStage(7)">B∆∞·ªõc cu·ªëi c√πng</button>
        </div>
    </div>

    <div id="stage-7" class="stage">
        <h2 style="color: #00695c;">B√¢y gi·ªù ch·ªã c·∫£m th·∫•y th·∫ø n√†o?</h2>
        <div id="final-emoji" style="font-size: 80px; margin: 20px 0;">üòê</div>
        <div id="final-status" style="font-size: 24px; font-weight: bold; color: #f57f17; margin-bottom: 30px;">5 - B√¨nh th∆∞·ªùng</div>
        <div style="width: 80%; max-width: 400px;">
            <input type="range" id="final-range" min="1" max="10" value="5" oninput="updateFinalEmotionDisplay()" style="width: 100%;">
        </div>
        <button class="btn-start" style="margin-top: 40px;" onclick="finishJourney()">L∆∞u H√†nh Tr√¨nh</button>
    </div>

    <div id="admin-modal" style="display:none; position:fixed; z-index:9999; background:white; width:100%; height:100%; top:0; left:0; overflow:auto; padding: 20px;">
        <button class="btn-history" onclick="closeAdmin()">ƒê√≥ng Admin</button>
        <h2>B·∫£ng Qu·∫£n Tr·ªã H·ªá Th·ªëng</h2>
        <table border="1" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <tbody id="admin-table-body"></tbody>
        </table>
    </div>
    <div id="my-history-modal" style="display:none; position:fixed; z-index:9999; background:white; width:100%; height:100%; top:0; left:0; overflow:auto; padding: 20px;">
        <button class="btn-history" onclick="closeMyHistory()">ƒê√≥ng</button>
        <h2 style="text-align:center; color: #00695c;">Nh·∫≠t K√Ω B√¨nh An C·ªßa Ch·ªã</h2>
        <div id="my-history-content"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>
